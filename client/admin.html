<main>

  <style>
    html, body {
			background-color: black;
			color: white;
			overflow-x: hidden;
			width: 100%;
			margin: 0;
			padding: 0;
    }
      
    .scrollable-section {
			width: 100%;
			height: 300px;
      overflow-x: hidden;
			overflow-y: auto;
			border: 1px solid #000;
			padding: 10px;
    }
  </style>

	<script>
		let admin_view = false;
		const submissions_url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQHCV5iOdkGD98XqUsXcqopC_R1EHe2Bz68nRVISd2bGXVoVmm84amKFhBOgITNJfyljfN2IdxtJw_5/pub?output=csv";

		String.prototype.hashCode = function() {
			var hash = 0,
				i, chr;
			if (this.length === 0) return hash;
			for (i = 0; i < this.length; i++) {
				chr = this.charCodeAt(i);
				hash = ((hash << 5) - hash) + chr;
				hash |= 0;
			}
			return hash;
		}
		async function checkLogin() {
			let password = document.getElementById("password").value;
			if (true){//password.hashCode() == -740554584) { //zD88l0DKvI
				document.getElementById("login").style.display = "none";
				document.getElementById("admin-view").style.display = "block";
				
				let submissions_contents = "";
				await fetch(submissions_url)
					.then(response => response.text())
					.then(content => {
						console.log("Submissions file loaded");
						submissions_contents = content;
					})
				.catch(error => console.error('Error loading Submissions file:', error));

				let submissions = submissions_contents.split("\n").map(row => row.split(","));
				submissions = submissions.map(row => row.map(cell => cell.replace(/\r/g, '').trim()).filter(cell => cell != "")).slice(1);

				for (submission of submissions) {
					document.getElementById("admin-view").innerHTML += `
					<label class="checkbox-wrapper" value="${submission}">
						<input type="checkbox" class="submission">
						<a href="${submission[3]}"><b>${submission[2]}</b></a> completed by <b>${submission[1]}</b> on <b>${submission[4]}</b>
					<br></label>`;
				};

				document.addEventListener("change", function(event) {
					if (event.target.classList.contains("submission")) {
						let parent = document.getElementById("admin-view"); 
						let wrapper = event.target.closest(".checkbox-wrapper");

						if (wrapper) {
								if (event.target.checked) parent.appendChild(wrapper);
								else parent.prepend(wrapper);
						}

            fetch("https://cors-anywhere.herokuapp.com/"+"https://script.google.com/macros/s/AKfycbyBR0WBRCqrMWRHwbQ3cE-0amh9uyylfRWT0bxLYTLGENKiXJfbx3eQeUUWP60gDvNoiA/exec", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                submission_data: `${event.target.value}`,
                value: `${event.target.checked}`
              })
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));
            console.log(
              JSON.stringify({
                submission_data: `${event.target.value}`,
                value: `${event.target.checked}`
              }));
					}
				});
			}
		}
	</script>

	<body>
		<div id="login" style="display:block">
			<button onclick="checkLogin()">Login</button>
			<input id="password" type="password" placeholder="Password">
		</div>
		<div id="admin-view" style="display:none">
		</div>
	</body>

</main>